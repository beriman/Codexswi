{% extends 'base.html' %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', path='css/nusantarum.css') }}?{{ static_asset_query }}" />
{% endblock %}

{% block content %}
<section class="nusantarum-page">
  <header class="nusantarum-hero">
    <div class="nusantarum-hero__copy">
      <p class="nusantarum-hero__eyebrow">Ensiklopedia Aroma Lokal</p>
      <h1>Nusantarum</h1>
      <p>
        Kurasi eksklusif perfumer, brand, dan parfum Nusantara yang telah melalui seleksi manual tim SensasiWangi.
        Jelajahi cerita di balik aroma, temukan rilis terbaru, dan ikuti kreator yang mempopulerkan wangi khas Indonesia.
      </p>
    </div>
    <dl class="nusantarum-hero__stats" aria-label="Statistik katalog Nusantarum">
      <div>
        <dt>Parfum Terkurasi</dt>
        <dd>{{ directory_totals.perfumes }}</dd>
      </div>
      <div>
        <dt>Brand Lokal</dt>
        <dd>{{ directory_totals.brands }}</dd>
      </div>
      <div>
        <dt>Perfumer</dt>
        <dd>{{ directory_totals.perfumers }}</dd>
      </div>
    </dl>
  </header>

  <nav class="nusantarum-tabs" role="tablist">
    <a
      class="nusantarum-tab"
      role="tab"
      aria-selected="{{ 'true' if active_tab == 'parfum' else 'false' }}"
      hx-get="/nusantarum/tab/parfum"
      hx-target="#nusantarum-tab-content"
      hx-include="#nusantarum-filter-form"
      hx-push-url="/nusantarum?tab=parfum"
      href="/nusantarum?tab=parfum"
    >
      <span>Parfum</span>
      <span class="nusantarum-tab__count">{{ directory_totals.perfumes }}</span>
    </a>
    <a
      class="nusantarum-tab"
      role="tab"
      aria-selected="{{ 'true' if active_tab == 'brand' else 'false' }}"
      hx-get="/nusantarum/tab/brand"
      hx-target="#nusantarum-tab-content"
      hx-include="#nusantarum-filter-form"
      hx-push-url="/nusantarum?tab=brand"
      href="/nusantarum?tab=brand"
    >
      <span>Brand</span>
      <span class="nusantarum-tab__count">{{ directory_totals.brands }}</span>
    </a>
    <a
      class="nusantarum-tab"
      role="tab"
      aria-selected="{{ 'true' if active_tab == 'perfumer' else 'false' }}"
      hx-get="/nusantarum/tab/perfumer"
      hx-target="#nusantarum-tab-content"
      hx-include="#nusantarum-filter-form"
      hx-push-url="/nusantarum?tab=perfumer"
      href="/nusantarum?tab=perfumer"
    >
      <span>Perfumer</span>
      <span class="nusantarum-tab__count">{{ directory_totals.perfumers }}</span>
    </a>
  </nav>

  <div class="nusantarum-controls">
    <form
      id="nusantarum-search-form"
      class="nusantarum-search"
      hx-get="/nusantarum/search"
      hx-target="#nusantarum-search-results"
      hx-trigger="keyup changed delay:400ms"
      hx-indicator="#nusantarum-search-results"
    >
      <label class="sr-only" for="nusantarum-search-input">Cari parfum, brand, atau perfumer</label>
      <input
        id="nusantarum-search-input"
        type="search"
        name="q"
        placeholder="Cari parfum, brand, atau perfumer"
        autocomplete="off"
      />
    </form>

    <div id="nusantarum-search-results">
      {% with results={'perfumes': [], 'brands': [], 'perfumers': []}, error_message=None %}
      {% include 'components/nusantarum/search-results.html' %}
      {% endwith %}
    </div>
  </div>

  <div class="nusantarum-body">
    <aside class="nusantarum-sidebar" aria-label="Filter katalog Nusantarum">
      {% include 'components/nusantarum/filter-panel.html' %}
    </aside>
    <section id="nusantarum-tab-content" class="nusantarum-content" aria-live="polite" aria-busy="false">
      {% with page=tab_page, error_message=error_message, active_tab=active_tab, sort=sort, direction=direction %}
      {% include tab_template %}
      {% endwith %}
    </section>
  </div>
</section>
{% endblock %}

{% block body_scripts %}
{{ super() }}
<script>
  (function () {
    const searchInput = document.getElementById('nusantarum-search-input');
    if (!searchInput) {
      return;
    }

    document.addEventListener('keydown', function (event) {
      const isTyping = event.target && (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' || event.target.isContentEditable);
      if (event.key === '/' && !event.defaultPrevented && !isTyping) {
        event.preventDefault();
        searchInput.focus();
        searchInput.select();
      }

      if (event.key === 'Escape' && document.activeElement === searchInput) {
        if (searchInput.value) {
          searchInput.value = '';
          searchInput.dispatchEvent(new Event('input', { bubbles: true }));
        }
        searchInput.blur();
      }
    });
  })();
</script>
{% endblock %}
