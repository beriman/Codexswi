<div id="profile-follow-button" class="profile-follow">
  {% if profile_view.viewer.is_owner %}
    {% set edit_url = request.url_for('profile_edit', username=profile.username) %}
    <a
      href="{{ edit_url }}{% if viewer_query %}?{{ viewer_query }}{% endif %}"
      class="profile-follow__edit"
      aria-label="Edit profil {{ profile.full_name }}"
    >Edit Profil</a>
  {% elif profile_view.viewer.is_following %}
    {% set unfollow_url = request.url_for('profile_unfollow', username=profile.username) %}
    <form
      action="{{ unfollow_url }}{% if viewer_query %}?{{ viewer_query }}{% endif %}"
      method="post"
      hx-delete="{{ unfollow_url }}{% if viewer_query %}?{{ viewer_query }}{% endif %}"
      hx-target="#profile-follow-button"
      hx-swap="outerHTML"
      class="profile-follow__form"
      onsubmit="if (window.htmx) { return false; }"
    >
      <input type="hidden" name="_method" value="DELETE" />
      <button
        type="submit"
        class="profile-follow__button profile-follow__button--muted"
        aria-pressed="true"
      >
        Mengikuti
      </button>
    </form>
  {% elif profile_view.viewer.can_follow %}
    {% set follow_url = request.url_for('profile_follow', username=profile.username) %}
    <form
      action="{{ follow_url }}{% if viewer_query %}?{{ viewer_query }}{% endif %}"
      method="post"
      hx-post="{{ follow_url }}{% if viewer_query %}?{{ viewer_query }}{% endif %}"
      hx-target="#profile-follow-button"
      hx-swap="outerHTML"
      class="profile-follow__form"
      onsubmit="if (window.htmx) { return false; }"
    >
      <button type="submit" class="profile-follow__button" aria-pressed="false">Ikuti</button>
    </form>
  {% else %}
    <a href="/auth" class="profile-follow__button profile-follow__button--ghost">Masuk untuk mengikuti</a>
  {% endif %}
</div>
{% if request.headers.get('hx-request') %}
  <div hx-swap-oob="true" id="profile-community-stats">
    {% include 'components/profile/stats.html' %}
  </div>
{% endif %}
