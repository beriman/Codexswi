{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-5xl">
    <!-- Breadcrumb -->
    <div class="mb-6">
        <nav class="text-sm breadcrumbs">
            <ul class="flex space-x-2 text-gray-600">
                <li><a href="/" class="hover:text-blue-600">Home</a></li>
                <li>›</li>
                <li><a href="/orders" class="hover:text-blue-600">Pesanan Saya</a></li>
                <li>›</li>
                <li class="text-blue-600 font-semibold">{{ order.order_number }}</li>
            </ul>
        </nav>
    </div>

    <div class="flex justify-between items-start mb-6">
        <div>
            <h1 class="text-3xl font-bold mb-2">Detail Pesanan</h1>
            <p class="text-gray-600">Nomor Pesanan: <span class="font-semibold">{{ order.order_number }}</span></p>
        </div>
        <div class="text-right">
            <span class="inline-block px-4 py-2 rounded-lg font-semibold
                {% if order.status == 'completed' %}bg-green-100 text-green-800
                {% elif order.status == 'shipped' %}bg-blue-100 text-blue-800
                {% elif order.status == 'processing' or order.status == 'paid' %}bg-yellow-100 text-yellow-800
                {% elif order.status == 'cancelled' %}bg-red-100 text-red-800
                {% else %}bg-gray-100 text-gray-800
                {% endif %}">
                {% if order.status == 'draft' %}Menunggu Konfirmasi
                {% elif order.status == 'awaiting_payment' %}Menunggu Pembayaran
                {% elif order.status == 'paid' %}Sudah Dibayar
                {% elif order.status == 'processing' %}Sedang Diproses
                {% elif order.status == 'shipped' %}Dikirim
                {% elif order.status == 'delivered' %}Terkirim
                {% elif order.status == 'completed' %}Selesai
                {% elif order.status == 'cancelled' %}Dibatalkan
                {% else %}{{ order.status }}
                {% endif %}
            </span>
        </div>
    </div>

    <!-- Order Timeline -->
    {% if order.order_status_history %}
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">Status Pesanan</h2>
        <div class="space-y-4">
            {% for history in order.order_status_history %}
            <div class="flex items-start">
                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                    <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div class="ml-4 flex-1">
                    <p class="font-semibold">
                        {% if history.status == 'draft' %}Pesanan Dibuat
                        {% elif history.status == 'awaiting_payment' %}Menunggu Pembayaran
                        {% elif history.status == 'paid' %}Pembayaran Diterima
                        {% elif history.status == 'processing' %}Pesanan Sedang Diproses
                        {% elif history.status == 'shipped' %}Pesanan Dikirim
                        {% elif history.status == 'delivered' %}Pesanan Terkirim
                        {% elif history.status == 'completed' %}Pesanan Selesai
                        {% elif history.status == 'cancelled' %}Pesanan Dibatalkan
                        {% else %}{{ history.status }}
                        {% endif %}
                    </p>
                    <p class="text-sm text-gray-600">{{ history.created_at[:19].replace('T', ' ') }}</p>
                    {% if history.note %}
                    <p class="text-sm text-gray-700 mt-1">{{ history.note }}</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-6">
            
            <!-- Order Items -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Item Pesanan</h2>
                <div class="space-y-4">
                    {% for item in order.order_items %}
                    <div class="flex items-start border-b pb-4 last:border-b-0">
                        <div class="flex-1">
                            <h3 class="font-semibold text-lg">{{ item.product_name }}</h3>
                            {% if item.brand_name %}
                            <p class="text-sm text-gray-600">{{ item.brand_name }}</p>
                            {% endif %}
                            {% if item.sku %}
                            <p class="text-xs text-gray-500 mt-1">SKU: {{ item.sku }}</p>
                            {% endif %}
                            <p class="text-sm text-gray-700 mt-2">
                                Jumlah: <span class="font-semibold">{{ item.quantity }}</span> × 
                                Rp {{ "{:,.0f}".format(item.unit_price) }}
                            </p>
                        </div>
                        <div class="text-right ml-4">
                            <p class="font-semibold text-lg">Rp {{ "{:,.0f}".format(item.subtotal_amount) }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Shipping Address -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Alamat Pengiriman</h2>
                {% if order.order_shipping_addresses %}
                {% set addr = order.order_shipping_addresses[0] %}
                <div class="text-gray-700">
                    <p class="font-semibold text-lg">{{ addr.recipient_name }}</p>
                    <p class="text-sm text-gray-600 mt-1">{{ addr.phone_number }}</p>
                    <div class="mt-3 text-sm">
                        <p>{{ addr.address_line }}</p>
                        {% if addr.additional_info %}
                        <p class="text-gray-600 italic">{{ addr.additional_info }}</p>
                        {% endif %}
                        <p class="mt-2">
                            {% if addr.subdistrict_name %}{{ addr.subdistrict_name }}, {% endif %}
                            {{ addr.city_name }}, {{ addr.province_name }}
                            {% if addr.postal_code %} {{ addr.postal_code }}{% endif %}
                        </p>
                    </div>
                </div>
                {% endif %}

                <!-- Tracking Number -->
                {% if order.metadata and order.metadata.tracking_number %}
                <div class="mt-4 pt-4 border-t">
                    <h3 class="font-semibold mb-2">Nomor Resi</h3>
                    <div class="bg-blue-50 px-4 py-3 rounded-lg">
                        <p class="text-lg font-mono font-bold text-blue-900">{{ order.metadata.tracking_number }}</p>
                    </div>
                    <p class="text-xs text-gray-600 mt-2">Gunakan nomor resi ini untuk melacak paket Anda</p>
                </div>
                {% endif %}
            </div>

            {% if order.notes %}
            <!-- Order Notes -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Catatan Pesanan</h2>
                <p class="text-gray-700">{{ order.notes }}</p>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1">
            <!-- Order Summary -->
            <div class="bg-white rounded-lg shadow-md p-6 sticky top-4">
                <h2 class="text-xl font-semibold mb-4">Ringkasan Pembayaran</h2>
                
                <div class="space-y-2 text-sm mb-4">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Subtotal</span>
                        <span>Rp {{ "{:,.0f}".format(order.subtotal_amount) }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Ongkos Kirim</span>
                        <span>
                            {% if order.shipping_amount > 0 %}
                            Rp {{ "{:,.0f}".format(order.shipping_amount) }}
                            {% else %}
                            <span class="text-gray-500">-</span>
                            {% endif %}
                        </span>
                    </div>
                    {% if order.discount_amount > 0 %}
                    <div class="flex justify-between text-green-600">
                        <span>Diskon</span>
                        <span>- Rp {{ "{:,.0f}".format(order.discount_amount) }}</span>
                    </div>
                    {% endif %}
                </div>

                <div class="border-t pt-4 mb-4">
                    <div class="flex justify-between text-lg font-bold">
                        <span>Total</span>
                        <span class="text-blue-600">Rp {{ "{:,.0f}".format(order.total_amount) }}</span>
                    </div>
                </div>

                <!-- Payment Status -->
                <div class="border-t pt-4">
                    <p class="text-sm text-gray-600 mb-2">Status Pembayaran</p>
                    <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold
                        {% if order.payment_status == 'paid' %}bg-green-100 text-green-800
                        {% elif order.payment_status == 'pending' %}bg-yellow-100 text-yellow-800
                        {% elif order.payment_status == 'failed' %}bg-red-100 text-red-800
                        {% else %}bg-gray-100 text-gray-800
                        {% endif %}">
                        {% if order.payment_status == 'paid' %}Sudah Dibayar
                        {% elif order.payment_status == 'pending' %}Menunggu Pembayaran
                        {% elif order.payment_status == 'failed' %}Gagal
                        {% elif order.payment_status == 'refunded' %}Dikembalikan
                        {% else %}{{ order.payment_status }}
                        {% endif %}
                    </span>
                </div>

                <!-- Order Date -->
                <div class="border-t pt-4 mt-4 text-sm text-gray-600">
                    <p>Dibuat: {{ order.created_at[:10] }}</p>
                    {% if order.paid_at %}
                    <p>Dibayar: {{ order.paid_at[:10] }}</p>
                    {% endif %}
                    {% if order.fulfilled_at %}
                    <p>Dikirim: {{ order.fulfilled_at[:10] }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Need Help -->
            <div class="bg-blue-50 rounded-lg p-4 mt-4">
                <h3 class="font-semibold mb-2">Butuh Bantuan?</h3>
                <p class="text-sm text-gray-700 mb-3">Hubungi customer service kami</p>
                <a href="mailto:support@sensasiwangi.id" class="text-sm text-blue-600 hover:underline block">
                    support@sensasiwangi.id
                </a>
                <a href="https://wa.me/6281234567890" class="text-sm text-blue-600 hover:underline block mt-1">
                    WhatsApp: 0812-3456-7890
                </a>
            </div>
        </div>
    </div>

    <!-- Back Button -->
    <div class="mt-8">
        <a href="/orders" class="inline-flex items-center text-blue-600 hover:text-blue-800">
            <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Kembali ke Daftar Pesanan
        </a>
    </div>
</div>
{% endblock %}
